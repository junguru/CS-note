# 데이터 링크 계층과 인터페이스

## 데이터 링크의 기능
* `framing`
    * 비트들을 묶어서 프레임으로 만들고 프레임 단위로 전송
* `error control`
    * 전송 시 에러가 발생하면 재전송하거나 에러 비트를 수정
* `flow control`
    * 정보가 유실되지 않도록 수신자의 처리 속도에 맞춰 전송 속도를 조절
* `medium access control`
    * 전송 매체를 여러 컴퓨터가 공유하므로 동시에 전송하지 않도록 순서를 정함
    * DLL의 헤더에 MAC 주소를 부착해 링크를 공유하는 어떤 컴퓨터가 수신할지 표시

<br/>
<br/>

## IP가 DLL에 요구하는 것

### 캡슐화
* 현재는 네트워크 계층에 IP가 주로 사용되지만, 원래는 데이터 링크 계층이 여러 네트워크 계층 프로토콜 지원
* 이더넷, 와이파이 등 프로토콜의 헤더에 어떤 상위 프로토콜을 가지는지 명시하는 필드 존재
    * 이더넷의 EtherType 필드
    * 802.11(와이파이)는 LLC 계층과 MAC 계층으로 나누어짐
    * LLC/SNAP 헤더에서 타입 필드로 네트워크 계층 프로토콜을 명시

### 주소 결졍 프로토콜 (ARP)
#### 공유 링크 vs 점대점 링크
* 공유 링크
    * 한 매체에 여러 인터페이스가 연결됨
* 점대점 링크
    * 한 매체가 두 기계만을 1대1로 연결하는 구조
    * 링크를 사용하는 상대 기계가 명확하므로 ARP가 불필요함

#### ARP
* 공유 링크 유형의 데이터 링크 기술에서 필요
* 다음 홉의 IP 주소를 이용해서 해당하는 인터페이스의 MAC 주소를 찾는 프로토콜
* 라우팅 과정
    1. 최종 IP 주소로부터 라우팅 테이블을 통해 다음 홉의 IP 주소 얻음
    2. ARP를 통해 다음 홉의 IP 주소로부터 MAC 주소를 얻음
* `arp cache`
    * IP 주소에 해당하는 MAC 주소를 저장해 놓은 테이블


### 관리 정보 베이스 (MIB)
* 데이터 링크 계층 프로토콜 및 기기를 원격으로 모니터링하거나 조종하기 위한 정보
* 이더넷 스위치 MIB를 예로 들면, 이때까지 송수신한 프레임 개수, 작동해온 시간 등 통계 정보

<br/>
<br/>

## 인터페이스
* 커널의 IP 입장에서, 링크 하드웨어(NIC)는 보이지 않음
* 대신 커널 자료구조인 인터페이스를 통해 링크 하드웨어에 접근
    * 디바이스 드라이버 인터페이스
    * MTU, RUNNING, BROADCAST, POINTTOPOINT 등 추가 정보를 포함
    * 각 NIC 인터페이스마다 IP주소가 할당됨

### local loopback interface
* 상응하는 하드웨어 NIC가 없이 커널 자료구조만으로 존재하는 인터페이스
    * 주로 IP주소 127.0.0.1 할당됨
    * 하드웨어 제한이 없으므로 MTU에 큰 값이 할당될 수 있음
* 같은 호스트 내의 프로세스끼리 통신할 경우 로컬 룹백 인터페이스 사용
    * TCP/IP 프로토콜은 결국 프로세스 간 통신(IPC)를 수행함
    * 로컬 룹백 인터페이스를 이용하면 하드웨어 NIC까지 내려갔다 오는 오버헤드가 없음

### MTU (Maximum Transmission Unit)
* 데이터 링크 기술의 페이로드에 적재할 수 있는 데이터그램의 최대 크기
    * 예를 들어 이더넷의 MTU는 1500 바이트
* 인터넷 트래픽의 대부분 데이터그램은 1500바이트 이하 크기임
    * 단대단 경로의 어딘가에 이더넷이 끼어 있는 비율이 상당히 높음
    * 경로 도중 라우터에서 분할이 일어나지 않기 위해 1500바이트로 미리 분할할 가능성이 큼

### device driver
* 커널 영역에 정의된 소프트웨어
    * 네트워크 인터페이스 칩 뿐만 아니라 키보드, 마우스, 디스크 등 IO 장치에 대해도 정의됨
    * 디바이스 드라이버를 통해 펌웨어나 하드웨어 루틴을 구동함
* 에러 검사 등 계산량이 높은 작업은 드라이버 루틴이 아닌 하드웨어가 수행