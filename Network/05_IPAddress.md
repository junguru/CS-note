# IP Address

## IPv4 주소
* IP 주소는 호스트 및 라우터의 인터페이스에 할당되는 주솟값
* 인터페이스에 할당된 IP 주소를 출발지와 목적지로 IP 데이터그램을 전송함
* 32비트의 이진 값으로, 점으로 구분된 네 개의 십진수로도 표현함
* 유니캐스트 주소, 멀티캐스트 주소, 브로드캐스트 주소 세 가지 유형이 존재
* 각 주소 유형이 각 유형의 MAC 주소에 대응됨

<br/>

### IPv4 주소 공간
* 5개의 클래스로 IPv4 주소를 구분
    * A : 0.0.0.0 ~ 127.255.255.255
    * B : 128.0.0.0 ~ 191.255.255.255
    * C : 192.0.0.0 ~ 223.255.255.255
    * D : 224.0.0.0 ~ 239.255.255.255
    * E : 240.0.0.0 ~ 255.255.255.255
* A, B, C는 유니캐스트 주소, D는 멀티캐스트 주소, E는 미할당
* 인터넷 초기에 A는 한번에 $2^{24}$개 묶음, B는 $2^{16}$개 묶음, C는 $2^{8}$개 묶음으로 기관에 배분함
* 클래스 B를 시작으로 주소 공간이 고갈되어 A, B는 잘라서, C는 묶어서 배분함

<br/>

### 유니캐스트 IP 주소
* 클래스 A, B, C 주소
* IPv4 주소 32비트를 네트워크 ID와 호스트 ID로 구분함
    * 예를 들어, 클래스 A를 할당받은 애플 사의 네트워크 ID는 17
    * IP주소 17.X.Y.Z 중 첫 8비트인 17을 네트워크 ID, 나머지를 호스트 ID로 구분
    * 라우팅 시 애플 망에 진입하는 게이트웨이 라우터에 도착할 때까지는 네트워크 ID만 사용
    * 망에 진입 후 호스트를 찾아갈 때 호스트 ID를 사용해 포워딩
* `CIDR` (Classless InterDomain Routing)
    * 주소 고갈 이후 클래스 크기와 관계 없이 주소 공간을 배분하니 네트워크 ID가 몇 비트인지 구분 불가
    * 라우팅 테이블의 엔트리에 주소와 함께 네트워크 ID의 길이를 함께 명시하는 표기법

<br/>

### IP 주소 집속
* 클래스 구분 없이 주소를 배분하니 라우팅 테이블 엔트리가 너무 많아짐
    * 7천 개의 주소가 필요한 기관에 주소를 배분하는 경우의 예시
    * B 클래스 1개 대신 30개의 C 클래스를 배분하면 주소 공간 낭비가 적음
    * 반면 라우팅 테이블 엔트리는 1개에서 30개로 크게 늘어남
* **주소 집속** (수퍼네팅 / 경로 요약)
    * 라우터에서 다음 홉과 출력 인터페이스가 같은 경우 여러 엔트리를 하나로 합침
    * 인접 지역이더라도 전혀 다른 주소 공간을 할당받았다면 집속을 할 수 없음
    * 192.x.x.x 등 클래스 C 주소를 집속을 고려하지 않고 무작위로 할당해 집속 불가능한 클래스 C 늪이 존재함

<br/>

### IP 주소 배급 체계
* IANA 에서 계층적으로 주소 공간을 배분함
    * IANA에서 아시아 태평양, 유럽 등 지역 레지스트리인 RIR에 배분
    * RIR은 하위 국가 NIC들에게 배분. 국가 NIC은 KT 등 국내 ISP에 배분
* 결국 IPv4 주소가 고갈되어 IPv6와 NAT가 고안됨

<br/>

### 서브넷
* 클래스 A와 B의 경우 호스트 ID가 길어 라우팅 테이블 크기가 커짐
* 대신 호스트 ID 중 일부를 서브넷 ID로 사용해 네트워크 ID와 서브넷 ID를 한 번에 CIDR 표기
* 서브넷을 통해 구성한 네트워크의 구조에 주소의 구조를 맞출 수 있음 (LAN에 속한 인터페이스들을 하나의 서브넷으로 구성)
* 서브넷의 크기를 유동적으로 변경 가능. 각 엔트리가 서브넷을 나타내게 해 라우팅 테이블 크기를 줄임.

<br/>

### 멀티캐스트 IP 주소
* 클래스 D 주소. 목적지 주소로만 사용됨
* 224.0.0.0/24 : 프로토콜의 제어에 사용. 자신이 속한 링크에만 멀티캐스트
* 239.0.0.0/8 : 한 기관의 네트워크 내에서만 사용 가능
* 이외 범위의 주소 : 전 세계 인터페이스 대상으로 멀티캐스트 가능
* IGMP 프로토콜에서 추가 서술
* 유니캐스트(ARP)와 달리, MAC주소를 얻는 정적인 규칙 존재
    * 앞 24비트는 IANA의 OUI인 01-00-5E 사용
    * 뒤 24비트는 0 :: 멀티캐스트 IP 주소의 하위 23비트
    * 32개의 IP 멀티캐스트 주소가 하나의 MAC 주소로 매핑되지만, IP 계층에서 목적지 주소를 보고 자신이 가입한 그룹인지 확인 가능

<br/>

### 브로드캐스트 IP 주소
* `limited` 브로드캐스트
    * 255.255.255.255 / 자신이 속한 링크에 브로드캐스트
* `directed` 브로드캐스트
    * 서브넷 ID까지는 그대로 표기하고, 나머지를 1로 채워 표기
    * 서브넷의 모든 인터페이스에 브로드캐스트
    * 보안상의 목적으로 거의 허용되지 않음 (희생자의 IP 주소를 출발지로 ICMP ping 등을 브로드캐스트하는 등 공격)

<br/>

### 특별한 IP 주소
* 사설 IP 주소
    * 망 내부에서만 쓸 수 있는 주소. 인터넷 공유기가 NAT 통해 할당
    * IPv4 주소의 고갈의 해결책
* 169.254.0.0/16
    * IP 주소를 직접 할당하거나 DHCP를 통해 주소를 할당받을 수 없을 경우 사용하는 link local 주소
    * 외부와 통신할 수 없어도 같은 LAN의 인터페이스들끼리 통신 가능

<br/>
<br/>

## IPv6 주소